<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Conversor de Medidas Culin√°rias ‚Äî Mobile</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f1724">
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#ffb86b; --glass: rgba(255,255,255,0.03);
      --radius:14px;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071021 0%, #0f1724 100%);color:#e6eef6}
    .wrap{max-width:820px;margin:18px auto;padding:18px}
    header{display:flex;gap:12px;align-items:center}
    header h1{font-size:18px;margin:0}
    .card{background:var(--card);border-radius:var(--radius);padding:14px;margin-top:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    select,input[type=number]{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;font-size:16px}
    .full{grid-column:1 / -1}
    button{width:100%;padding:12px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--accent),#ff8a5b);color:#072026;font-weight:700;font-size:16px}

    .row{display:flex;gap:8px}
    .small{padding:10px;font-size:14px}
    .result{font-size:16px;padding:12px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:#dff0ef}
    .muted{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px}
    .icon-btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:10px;color:var(--muted);min-width:44px}
    .fav-list{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:999px;font-size:13px}
    footer{margin-top:14px;text-align:center;color:var(--muted);font-size:12px}

    @media (max-width:520px){.grid{grid-template-columns:1fr}.wrap{padding:12px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <svg width="44" height="44" viewBox="0 0 24 24" fill="none" aria-hidden><rect width="24" height="24" rx="6" fill="#ffb86b"/><path d="M7 14s1-2 5-2 5 2 5 2" stroke="#072026" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <h1>Conversor de Medidas Culin√°rias ‚Äî Mobile</h1>
    </header>

    <div class="card" role="application">
      <div class="grid">
        <div>
          <label for="alimento">Alimento</label>
          <select id="alimento" aria-label="Alimento"></select>
        </div>

        <div>
          <label for="valor">Valor</label>
          <input id="valor" type="number" inputmode="decimal" step="any" min="0" placeholder="Ex: 1.5" aria-label="Valor" />
        </div>

        <div>
          <label for="de">De (unidade)</label>
          <select id="de" aria-label="Unidade de origem"></select>
        </div>

        <div>
          <label for="para">Para (unidade)</label>
          <select id="para" aria-label="Unidade destino"></select>
        </div>

        <div class="full">
          <div style="display:flex;gap:8px;margin-bottom:8px">
            <button id="converter">Converter</button>
            <button id="swap" class="icon-btn small" title="Trocar unidades">‚Üî</button>
            <button id="copiar" class="icon-btn small" title="Copiar resultado">üìã</button>
            <button id="compartilhar" class="icon-btn small" title="Compartilhar">ÔøΩshare;</button>
          </div>

          <div class="result" id="resultado" aria-live="polite">Resultado aparecer√° aqui</div>
          <div class="muted" style="margin-top:8px">Toque no resultado para copiar. Hist√≥rico e favoritos s√£o salvos localmente.</div>
        </div>

        <div class="full">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="muted">Favoritos</div>
            <div class="controls"><button id="salvar-fav" class="icon-btn small">üíæ Salvar</button><button id="limpar-hist" class="icon-btn small">üóë Limpar</button></div>
          </div>
          <div id="favoritos" class="fav-list" aria-live="polite"></div>
        </div>

      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="muted">Hist√≥rico</div>
      <div id="historico" style="margin-top:8px"></div>
    </div>

    <footer>Feito para abrir no Chrome (Android). Offline ‚Äî sem rastreamento. ‚ú®</footer>
  </div>

  <script>
    // Dados
    const alimentos = [
      '√Ågua','Leite','Farinha de Trigo','Farinha de Mandioca','Manteiga','√ìleo',
      'Chocolate em P√≥','Chocolate em Barra','Chocolate em Gotas','Mel','A√ß√∫car',
      'Sal','Amido de Milho','Arroz','Feij√£o','Aveia'
    ];

    const unidades = [
      'g','kg','L','mL','x√≠cara','colher de ch√°','colher de sopa','colher de sobremesa','oz','libra','copo'
    ];

    // Densidades g/mL (consistentes entre fun√ß√µes)
    const densidades = {
      '√Ågua':1,'Leite':1.03,'Farinha de Trigo':0.59,'Farinha de Mandioca':0.72,'Manteiga':0.91,'√ìleo':0.92,
      'Chocolate em P√≥':0.54,'Chocolate em Barra':1.3,'Chocolate em Gotas':1.3,'Mel':1.4,'A√ß√∫car':0.85,'Sal':1.2,
      'Amido de Milho':0.55,'Arroz':0.85,'Feij√£o':0.75,'Aveia':0.4
    };

    // Helpers de DOM
    const $alimento = document.getElementById('alimento');
    const $de = document.getElementById('de');
    const $para = document.getElementById('para');
    const $valor = document.getElementById('valor');
    const $resultado = document.getElementById('resultado');
    const $converter = document.getElementById('converter');
    const $swap = document.getElementById('swap');
    const $copiar = document.getElementById('copiar');
    const $salvarFav = document.getElementById('salvar-fav');
    const $favoritos = document.getElementById('favoritos');
    const $historico = document.getElementById('historico');
    const $compartilhar = document.getElementById('compartilhar');

    // Popular selects
    function populate(){
      alimentos.forEach(a => $alimento.insertAdjacentHTML('beforeend', `<option value="${a}">${a}</option>`));
      unidades.forEach(u => { $de.insertAdjacentHTML('beforeend', `<option value="${u}">${u}</option>`); $para.insertAdjacentHTML('beforeend', `<option value="${u}">${u}</option>`); });
      // defaults
      $alimento.value = '√Ågua'; $de.value='g'; $para.value='x√≠cara';
      loadFavs(); loadHist();
    }

    // Convers√µes
    function paraGramas(valor, unidade, alimento){
      const dens = densidades[alimento] ?? 1;
      if(unidade==='g') return valor;
      if(unidade==='kg') return valor*1000;
      if(unidade==='L') return valor*1000*dens;
      if(unidade==='mL') return valor*dens;
      if(unidade==='x√≠cara') return valor*240*dens;
      if(unidade==='colher de ch√°') return valor*5*dens;
      if(unidade==='colher de sopa') return valor*15*dens;
      if(unidade==='colher de sobremesa') return valor*10*dens;
      if(unidade==='oz') return valor*28.35;
      if(unidade==='libra') return valor*453.592;
      if(unidade==='copo') return valor*250*dens;
      throw new Error('Unidade n√£o reconhecida');
    }

    function deGramas(valor, unidade, alimento){
      const dens = densidades[alimento] ?? 1;
      if(unidade==='g') return valor;
      if(unidade==='kg') return valor/1000;
      if(unidade==='L') return valor/(1000*dens);
      if(unidade==='mL') return valor/dens;
      if(unidade==='x√≠cara') return valor/(240*dens);
      if(unidade==='colher de ch√°') return valor/(5*dens);
      if(unidade==='colher de sopa') return valor/(15*dens);
      if(unidade==='colher de sobremesa') return valor/(10*dens);
      if(unidade==='oz') return valor/28.35;
      if(unidade==='libra') return valor/453.592;
      if(unidade==='copo') return valor/(250*dens);
      throw new Error('Unidade n√£o reconhecida');
    }

    function formatValue(v){
      if(Number.isNaN(v)) return '‚Äî';
      if(Math.abs(v) < 0.0001) return v.toExponential(3);
      return Number(v.toFixed(4)).toString();
    }

    // A√ß√£o converter
    function runConversion(){
      const alimento = $alimento.value;
      const de = $de.value;
      const para = $para.value;
      const valor = parseFloat($valor.value);
      if(!isFinite(valor)) { alert('Informe um valor num√©rico v√°lido'); return; }

      const g = paraGramas(valor, de, alimento);
      const out = deGramas(g, para, alimento);

      const texto = `${formatValue(valor)} ${de} de ${alimento} = ${formatValue(out)} ${para}`;
      $resultado.textContent = texto;
      saveHistory(texto);
    }

    // Swap
    $swap.addEventListener('click', ()=>{
      const a=$de.value; $de.value=$para.value; $para.value=a;
    });

    // Copy
    $resultado.addEventListener('click', ()=> copyText($resultado.textContent));
    $copiar.addEventListener('click', ()=> copyText($resultado.textContent));
    function copyText(t){
      if(!t || t.includes('Resultado')) return;
      navigator.clipboard?.writeText(t).then(()=>{toast('Copiado para a √°rea de transfer√™ncia')}).catch(()=>{alert('N√£o foi poss√≠vel copiar')});
    }

    // Share
    $compartilhar.addEventListener('click', async ()=>{
      const t = $resultado.textContent || '';
      if(navigator.share){
        try{ await navigator.share({text:t}); }catch(e){}
      }else{ copyText(t); }
    });

    // Favoritos
    function loadFavs(){
      const fav = JSON.parse(localStorage.getItem('conv_favs')||'[]');
      $favoritos.innerHTML = '';
      fav.forEach((f, i)=>{
        const el = document.createElement('button'); el.className='chip'; el.textContent=`${f.valor} ${f.de}‚Üí${f.para} (${f.alimento})`;
        el.onclick = ()=>{ $valor.value=f.valor; $de.value=f.de; $para.value=f.para; $alimento.value=f.alimento; runConversion(); };
        $favoritos.appendChild(el);
      });
    }
    $salvarFav.addEventListener('click', ()=>{
      const fav = JSON.parse(localStorage.getItem('conv_favs')||'[]');
      fav.unshift({valor:$valor.value||'1',de:$de.value,para:$para.value,alimento:$alimento.value});
      localStorage.setItem('conv_favs', JSON.stringify(fav.slice(0,12)));
      loadFavs(); toast('Favorito salvo');
    });

    // Hist√≥rico
    function saveHistory(txt){
      const h = JSON.parse(localStorage.getItem('conv_hist')||'[]');
      h.unshift({t:txt,ts:Date.now()});
      localStorage.setItem('conv_hist', JSON.stringify(h.slice(0,50)));
      loadHist();
    }
    function loadHist(){
      const h = JSON.parse(localStorage.getItem('conv_hist')||'[]');
      $historico.innerHTML = '';
      if(h.length===0){ $historico.innerHTML = '<div class="muted">Nenhuma convers√£o ainda</div>'; return; }
      h.forEach(it => {
        const d = document.createElement('div'); d.className='muted'; d.style.padding='6px 0'; d.textContent = it.t; d.onclick = ()=>{ copyText(it.t); };
        $historico.appendChild(d);
      });
    }
    document.getElementById('limpar-hist').addEventListener('click', ()=>{ localStorage.removeItem('conv_hist'); loadHist(); toast('Hist√≥rico limpo'); });

    // Feedback simples
    function toast(msg){
      const el = document.createElement('div'); el.textContent = msg; el.style.position='fixed'; el.style.left='50%'; el.style.transform='translateX(-50%)'; el.style.bottom='24px';
      el.style.background='rgba(0,0,0,0.6)'; el.style.padding='8px 12px'; el.style.borderRadius='999px'; el.style.color='#fff'; el.style.zIndex=9999; document.body.appendChild(el);
      setTimeout(()=>el.remove(),1500);
    }

    // evento do bot√£o
    $converter.addEventListener('click', runConversion);

    // teclado: enter converte
    $valor.addEventListener('keydown', e=>{ if(e.key==='Enter') runConversion(); });

    // Inicializa√ß√£o
    populate();

    // Small accessibility: touch target
    document.querySelectorAll('button').forEach(b=>b.addEventListener('touchstart', ()=>{}));
	// Registrar Service Worker (PWA)
    if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js');
    });
    }
  </script>
</body>
</html>
